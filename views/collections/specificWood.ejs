<section class="specificCustom">

  <div
  id="carouselExampleControls"
  class="carousel slide mt-4"
  data-bs-ride="carousel"
  >
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img
      src="https://istude.s3.ap-south-1.amazonaws.com/legendaryShield/images/woodwork/<%=woodItem.imgLink%>"
        class="d-block w-100"
        alt="..."
      />
      <!-- <img src="images/img10.png"  alt="..."> -->
    </div>
  
    <% for( let i=0; i < woodItem.relatedImages.length; i++ ) { %>
    <div class="carousel-item active">
      <img
      src="https://istude.s3.ap-south-1.amazonaws.com/legendaryShield/images/woodwork/<%=woodItem.imgLink%>"
        class="d-block w-100"
        alt="..."
      />
    </div>
    <% } %>
  </div>
  
  <button
    class="carousel-control-prev"
    type="button"
    data-bs-target="#carouselExampleControls"
    data-bs-slide="prev"
  >
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
    <!-- <p class="prevBtn">&DoubleLeftArrow;</p> -->
  </button>
  <button
    class="carousel-control-next"
    type="button"
    data-bs-target="#carouselExampleControls"
    data-bs-slide="next"
  >
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
  </div>
  
  <div class="productDetails">
  <div class="productDetails">
    <div class="brandName">
      <h2><%=woodItem.woodItem %></h2>
    </div>
    <div>
      <p>
        <span><%=woodItem.details%></span>
        <span class="" id="customPrice"><i>from</i> K<%=woodItem.price%> </span>
      </p>
    </div>
    <div class="price">
      <h3><strong>K <%=woodItem.price %></strong></h3>
    </div>
    <div>
      <hr />
      <select id="font-type" name="font-type">
        <option value="" disabled selected>select font type</option>
        <option value="font-1">font-1</option>
        <option value="font-2">font-2</option>
        <option value="font-3">font-3</option>
        <option value="font-4">font-4</option>
        <option value="font-5">font-5</option>
      </select>
      <hr />
      <label for="">Upload image</label><br />
      <label for="yesIMG">Yes</label>
      <input type="radio" name="woodIMG" id="yesIMG" />
      <label for="noIMG">No</label>
      <input type="radio" name="woodIMG" id="noIMG" />
      <form
        id="formWithImage"
        action="/cartWithImage"
        method="post"
        id="imageForm"
        enctype="multipart/form-data"
      >
        <input type="file" name="sampleImage" id="sampleImage" />
      </form>
      <form
        id="formNoImage"
        style="display: none"
        action="/cart"
        method="get"
      ></form>
      <br />
      <hr />
      <label for="">Add custom text</label><br />
      <label for="yesText">Yes</label>
      <input type="radio" name="woodText" id="yesText" />
      <label for="noText">No</label>
      <input type="radio" name="woodText" id="noText" />
      <br />
      <textarea
        name="customText"
        id="yesTextArea"
        cols="30"
        rows="10"
      ></textarea>
    </div>
    <hr />
    <ul>
      <li>
        <i
          >A preview of your design will be emailed to you within
          <span id="textPreview">2-3 working days</span>.</i
        >
      </li>
      <li>
        <i
          >You can either
          <span id="textPreview">confirm the design or ask for changes</span> on
          it.</i
        >
      </li>
      <li>
        <i
          >Once design is confirmed, production will take
          <span id="textPreview">3-4 working days</span>.</i
        >
      </li>
      <li>
        <i
          >The delivery time for any engraved product is about
          <span id="textPreview">8-12 working days</span>.</i
        >
      </li>
    </ul>
    <hr />
    <div class="buttons">
      <div id="buyBtn" id="<%=woodItem.woodItem%>">
        <span>
          <span style="color: white; text-decoration: none">Buy it now</span>
        </span>
      </div>
      <div class="cartBtn" id="<%=woodItem.woodItem%>">
        <span style="color: black" href="/cartImage">Add to cart</span>
      </div>
    </div>
    <hr />
  </div>
  
  <input type="hidden" value="<%=woodItem.woodItem%>" id="itemName" />
  <input
    type="hidden"
    value="<%= woodItem.ImagesPath%>\<%=woodItem.imgLink%>"
    id="itemImages"
  />
  <input type="hidden" value="<%=woodItem.price%>" id="itemPrice" />
  </div>
</section>
  

<script>
  const buyButton = document.querySelector("#buyBtn");
  const addToCartButton = document.querySelector(".cartBtn");
  const yesTextArea = document.getElementById("yesTextArea");
  const yesText = document.getElementById("yesText");
  const noText = document.getElementById("noText");
  const yesIMG = document.getElementById("yesIMG");
  const noIMG = document.getElementById("noIMG");
  const sampleImage = document.getElementById("sampleImage");
  const woodtype = document.getElementById("wood-type");

  const itemName = document.getElementById("itemName").value;
  const itemImage = document.getElementById("itemImages").value;
  const itemPrice = document.getElementById("itemPrice").value;

  yesTextArea.style.display = "none";
  sampleImage.style.display = "none";
  yesText.addEventListener("click", () => {
    yesTextArea.style.display = "block";
  });

  noText.addEventListener("click", () => {
    yesTextArea.style.display = "none";
  });

  yesIMG.addEventListener("click", () => {
    sampleImage.style.display = "block";
  });
  noIMG.addEventListener("click", () => {
    sampleImage.style.display = "none";
  });

  let currCart = localStorage.getItem("cartList");
  let cartData = JSON.stringify({
    itemName,
    itemPrice,
    itemImage,
    quantity: 1,
    data: { text: yesTextArea.value, woodType: woodtype.value, imagePath: "" },
  });

  console.log(cartData);
  const cartNoForm = document.getElementById("formNoImage");
  const cartImageForm = document.getElementById("formWithImage");

  cartData?.split("+").forEach((item) => {
    currCart?.split("+").forEach((cartItem) => {
      if (cartItem) {
        const a = JSON.parse(item);
        const b = JSON.parse(cartItem);
        if (a.itemName == b.itemName) {
          yesTextArea.value = b.data.text;
          addToCartButton.innerText = "Added";
        }
      }
    });
  });

  buyButton.addEventListener("click", () => {
    cartData = JSON.stringify({
      itemName,
      itemPrice,
      itemImage,
      quantity: 1,
      productType:'wood',
      data: {
        text: yesTextArea.value,
        woodType: woodtype.value,
        imagePath: "",
      },
    });
    
    if (addToCartButton.innerText != "Added") {
      addToCartButton.innerText = "Added";
      if (localStorage.getItem("cartList") != null) {
        localStorage.setItem(
          "cartList",
          localStorage.getItem("cartList") + `${cartData}+`
        );
      } else {
        localStorage.setItem("cartList", `${cartData}+`);
      }
    }

    if (sampleImage.value) {
      cartImageForm.submit();
    } else {
      cartNoForm.submit();
    }
  });

  addToCartButton.addEventListener("click", () => {
    console.log(woodtype.value);
    cartData = JSON.stringify({
      itemName,
      itemPrice,
      itemImage,
      quantity: 1,
      productType:'wood',
      data: {
        text: yesTextArea.value,
        woodType: woodtype.value,
        imagePath: "",
      },
    });
    if (addToCartButton.innerText == "Added") {
      addToCartButton.innerText = "Add To Cart";
      const oldCart = localStorage.getItem("cartList");
      const newCart = oldCart.replace(`${cartData}+`, "");
      localStorage.setItem("cartList", newCart);
      document.getElementById("cartCounter").innerText =
        localStorage.getItem("cartList").split("+").length - 1;
    } else {
      if (localStorage.getItem("cartList") != null) {
        localStorage.setItem(
          "cartList",
          localStorage.getItem("cartList") + `${cartData}+`
        );
      } else {
        localStorage.setItem("cartList", `${cartData}+`);
      }
      addToCartButton.innerText = "Added";
      document.getElementById("cartCounter").innerText =
        localStorage.getItem("cartList").split("+").length - 1;
    }
    if (sampleImage.value) {
      cartImageForm.submit();
    }
    // console.log(addToCartButton.id)
    // console.log(localStorage)
  });
</script>
